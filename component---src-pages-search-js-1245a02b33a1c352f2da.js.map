{"version":3,"sources":["webpack:////Volumes/Data/working/Unitz/ws-app-web/modules/unitz-models/CategoryModel/index.js","webpack:////Volumes/Data/working/Unitz/ws-app-web/node_modules/formik-antd/es/slider/index.js","webpack:////Volumes/Data/working/Unitz/ws-app-web/modules/unitz-pages/SearchPage/View.js","webpack:////Volumes/Data/working/Unitz/ws-app-web/modules/unitz-pages/SearchPage/Data.js","webpack:////Volumes/Data/working/Unitz/ws-app-web/modules/unitz-pages/SearchPage/index.js","webpack:///./src/pages/search.js","webpack:////Volumes/Data/working/Unitz/ws-app-web/modules/unitz-pages/withPageContext.js","webpack:////Volumes/Data/working/Unitz/ws-app-web/node_modules/formik-antd/es/select/index.js"],"names":["graphme","GqlBuilder","loadDocument","GetCategory","CategoryModel","addNewCategory","advisor_id","category_id","query","hasuraClient","gql","getClient","request","rtn","data","console","log","removeNewCategory","id","BaseModel","DEFINITION","Definition","create","name","schema","String","display_name","key","baseQuery","GQL_ACTIONS","GET","FIND","INSERT","UPDATE","DELETE","model","Slider","_a","validate","fast","_onChange","onChange","restProps","_ref","value","field","_ref$form","form","setFieldValue","setFieldTouched","Object","assign","valueOf","Index","props","DIV","className","HeroSection","RESABLE","ctx","debug","categories","resable","for","get","set","AdvisorSearchForm","Data","bindings","pageContainer","rules","hook","allContentfulCategory","apply","catListFilterStr","map","item","join","usePromiseSource","a","find","toObject","priceRangeOptions","options","min","max","step","defaultValue","advisorSearchForm","route","useRoute","useFormik","initialValues","category","service","priceRange","onSubmit","values","actions","minPrice","maxPrice","navigate","to","error","setStatus","validationSchema","Yup","shape","isLoading","display","notLoading","View","SearchIndex","withPageContext","location","PageData","SEO","pageData","POS","SearchPage","DataContext","React","createContext","provideData","dataKey","dataContext","useContext","Comp","pageContext","setPageContext","Provider","Select","children","_onBlur","onBlur","option","undefined","Option","OptGroup"],"mappings":"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","file":"component---src-pages-search-js-1245a02b33a1c352f2da.js","sourcesContent":["import _ from 'lodash';\nimport graphme from '@unitz/graphme';\n\nimport hasuraClient from '@vl/mod-clients/hasuraApp';\n\nimport GetCategory from 'unitz-gql/category/GetCategory.gql';\n\ngraphme.GqlBuilder.loadDocument({\n  GetCategory\n});\n\nclass CategoryModel extends graphme.BaseModel {\n  static DEFINITION = graphme.Definition.create({\n    name: 'CategoryModel',\n    schema: {\n      id: String,\n      display_name: String\n    },\n\n    key: 'id',\n\n    baseQuery: 'GetCategory',\n    GQL_ACTIONS: {\n      GET: 'category_by_pk',\n      FIND: 'category',\n      INSERT: 'insert_category_one',\n      UPDATE: 'update_category_by_pk',\n      DELETE: 'delete_category_by_pk'\n    },\n    getClient: hasuraClient.getClient\n  });\n\n  static async addNewCategory({ advisor_id, category_id }) {\n    const query = hasuraClient.gql`\n      mutation addNewCategory($advisor_id: uuid!, $category_id: String!) {\n        profile: insert_advisor_profile_category(objects: {category_id: $category_id, advisor_profile_id: $advisor_id}, on_conflict: {constraint: advisor_profile_category_advisor_profile_id_category_id_key, update_columns: created_at}) {\n          returning {\n            id\n          }\n        }\n      }\n    `;\n    try {\n      const rtn = await hasuraClient.getClient().request(query, {\n        category_id,\n        advisor_id\n      });\n\n      const data = _.get(rtn, 'profile.returning');\n      if (data) {\n        return data;\n      }\n    } catch (err) {\n      console.log(err);\n    }\n\n    return null;\n  }\n\n  static async removeNewCategory({ id }) {\n    const query = hasuraClient.gql`\n      mutation removeNewCategory($id: String!) {\n        profile: delete_advisor_profile_category(where: {category_id: {_eq: $id}}) {\n          returning {\n            id\n          }\n        }\n      }\n    `;\n    try {\n      const rtn = await hasuraClient.getClient().request(query, {\n        id\n      });\n\n      const data = _.get(rtn, 'profile.returning');\n      if (data) {\n        return data;\n      }\n    } catch (err) {\n      console.log(err);\n    }\n\n    return null;\n  }\n}\n\ngraphme.model({ CategoryModel });\n\nexport default CategoryModel;\n","import { __rest } from \"tslib\";\nimport { Slider as $Slider } from 'antd';\nimport * as React from 'react';\nimport Field from '../field';\nexport var Slider = function Slider(_a) {\n  var name = _a.name,\n      validate = _a.validate,\n      fast = _a.fast,\n      _onChange = _a.onChange,\n      restProps = __rest(_a, [\"name\", \"validate\", \"fast\", \"onChange\"]);\n\n  return React.createElement(Field, {\n    name: name,\n    validate: validate,\n    fast: fast\n  }, function (_ref) {\n    var value = _ref.field.value,\n        _ref$form = _ref.form,\n        setFieldValue = _ref$form.setFieldValue,\n        setFieldTouched = _ref$form.setFieldTouched;\n    return React.createElement($Slider, Object.assign({\n      value: value,\n      onChange: function onChange(value) {\n        setFieldValue(name, value != null ? value.valueOf() : value);\n        setFieldTouched(name, true, false);\n        _onChange && _onChange(value);\n      }\n    }, restProps));\n  });\n};\nexport default Slider;","import React from 'react';\n\nimport { ctx } from '@vl/redata';\nimport DIV from '@vl/redata/DIV.macro';\nimport { resable } from '@vl/redata/RESABLE';\nimport RESABLE from '@vl/redata/RESABLE.macro';\nimport HeroSection from '@uz/unitz-components-web/HeroSection';\nimport AdvisorSearchForm from '@uz/unitz-components-web/AdvisorSearchForm';\n\nconst Index = (props) => {\n  // @TODO: validate missing required input\n  return (\n    <DIV className=\"pageContainer\">\n      <div className=\"relative none-container\">\n        <HeroSection />\n        <div className=\"absolute w-full bottom-12\">\n          <RESABLE>\n            <DIV>\n              {ctx.debug(() => {\n                const categories = resable.for('categories')(ctx.get('categories'), []);\n                ctx.set('categories', categories);\n              })}\n              <AdvisorSearchForm />\n            </DIV>\n          </RESABLE>\n        </div>\n      </div>\n    </DIV>\n  );\n};\n\nexport default Index;\n","import { bindings, hook } from '@vl/redata';\nimport _ from 'lodash';\nimport CategoryModel from '@uz/unitz-models/CategoryModel';\nimport { useFormik } from 'formik';\nimport * as Yup from 'yup';\nimport useRoute from '@vl/hooks/useGbRoute';\nimport usePromiseSource from '@vl/hooks/usePromiseSource';\n\nconst bindData = bindings({\n  pageContainer: {\n    rules: [\n      [\n        'data',\n        {\n          data: {\n            categories: hook((ctx) => {\n              const allContentfulCategory = ctx.apply('ctf.getNodes', 'allContentfulCategory.nodes', []);\n              const catListFilterStr = _.map(allContentfulCategory, 'id')\n                .map((item) => `\"${item}\"`)\n                .join(',');\n\n              const categories = usePromiseSource(\n                () => async () => {\n                  try {\n                    const categories = await CategoryModel.find(\n                      `where: { id: {_in: [${catListFilterStr}]}}, limit: 20`,\n                      'id avatar_url display_name icon slug'\n                    );\n                    return categories.toObject();\n                  } catch (err) {}\n                },\n                [],\n                []\n              );\n              return categories;\n            }),\n            priceRangeOptions: hook(() => {\n              const options = {\n                min: 100000,\n                max: 5000000,\n              };\n              options.step = (options.max - options.min) / 20;\n              options.defaultValue = [options.min + options.step, options.max - options.step];\n\n              return options;\n            }),\n\n            advisorSearchForm: hook((ctx) => {\n              const route = useRoute();\n              const form = useFormik({\n                initialValues: {\n                  category: '',\n                  service: '',\n                  priceRange: ctx.get('priceRangeOptions.defaultValue'),\n                },\n                onSubmit: async (values, actions) => {\n                  try {\n                    const { priceRange } = values;\n                    const [minPrice, maxPrice] = priceRange;\n                    route.navigate(\n                      route.to('/filter', {\n                        ..._.omit(values, ['priceRange']),\n                        min: minPrice,\n                        max: maxPrice,\n                      })\n                    );\n                  } catch (error) {\n                    actions.setStatus({\n                      error,\n                    });\n                  }\n                },\n                validationSchema: Yup.object().shape({}),\n              });\n              return form;\n            }),\n          },\n        },\n      ],\n    ],\n  },\n  isLoading: {\n    rules: [\n      [\n        'display',\n        {\n          display: hook((ctx) => ctx.apply('loadingModel.isLoading')),\n        },\n      ],\n    ],\n  },\n  notLoading: {\n    rules: [\n      [\n        'display',\n        {\n          display: hook((ctx) => !ctx.apply('loadingModel.isLoading')),\n        },\n      ],\n    ],\n  },\n});\n\nexport default bindData;\n","import View from './View.js';\nimport Data from './Data.js';\n\nexport default Data(View);\n","import React from 'react';\n\nimport { ctx } from '@vl/redata';\nimport DIV from '@vl/redata/DIV.macro';\n\nimport App from '@uz/unitz-app-web/UserApp';\nimport SEO from '@uz/unitz-layout-web/SEO';\n\nimport Layout from '@uz/unitz-layout-web/LayoutMain';\n\nimport SearchPage from '@uz/unitz-pages/SearchPage';\nimport withPageContext from '@uz/unitz-pages/withPageContext';\n\nimport PageData from '../data/PageDataQuery';\n\nconst SearchIndex = withPageContext((props) => {\n  return (\n    <App>\n      <Layout location={props.location} PageData={PageData}>\n        <DIV>\n          <SEO pageData={ctx.apply('ctf.findPage', { name: 'Homepage' })} />\n          <Layout.POS name=\"app-header\">{ctx.apply('ctf.renderSection', { name: 'articleNavbarSection' })}</Layout.POS>\n          <Layout.POS name=\"app-body\">\n            <SearchPage />\n          </Layout.POS>\n          <Layout.POS name=\"app-footer\">{ctx.apply('ctf.renderSection', { name: 'articleFooterSection' })}</Layout.POS>\n        </DIV>\n      </Layout>\n    </App>\n  );\n});\n\nexport default SearchIndex;\n","import React from 'react';\n\nimport { ctx } from '@vl/redata';\nimport DIV from '@vl/redata/DIV.macro';\n\nimport _ from 'lodash';\nimport useRoute from '@vl/hooks/useGbRoute';\n\nexport const DataContext = React.createContext();\n\nexport const provideData = (dataKey, value) => {\n  const dataContext = React.useContext(DataContext);\n  _.set(dataContext, dataKey, value);\n};\n\nexport const consumeData = (dataKey) => {\n  const dataContext = React.useContext(DataContext);\n  return _.get(dataContext, dataKey);\n};\n\nconst withPageContext = (Comp) => {\n  return (props) => {\n    const pageContext = _.get(props, 'pageContext');\n    // eslint-disable-next-line\n    const route = useRoute();\n    route.setPageContext(pageContext);\n    return (\n      <DataContext.Provider value={{}}>\n        <DIV>\n          {ctx.debug(() => {\n            ctx.set('pageContext', pageContext);\n          })}\n          <Comp {...props} />\n        </DIV>\n      </DataContext.Provider>\n    );\n  };\n};\n\nexport default withPageContext;\n","import { __rest } from \"tslib\";\nimport { Select as $Select } from 'antd';\nimport * as React from 'react';\nimport Field from '../field'; // declare class Select<ValueType extends SelectValue = SelectValue> extends React.Component<SelectProps<ValueType>> {\n\nexport var Select = function Select(_a) {\n  var name = _a.name,\n      validate = _a.validate,\n      fast = _a.fast,\n      children = _a.children,\n      _onChange = _a.onChange,\n      _onBlur = _a.onBlur,\n      restProps = __rest(_a, [\"name\", \"validate\", \"fast\", \"children\", \"onChange\", \"onBlur\"]);\n\n  return React.createElement(Field, {\n    name: name,\n    validate: validate,\n    fast: fast\n  }, function (_ref) {\n    var value = _ref.field.value,\n        _ref$form = _ref.form,\n        setFieldValue = _ref$form.setFieldValue,\n        setFieldTouched = _ref$form.setFieldTouched;\n    return React.createElement($Select, Object.assign({\n      onChange: function onChange(value, option) {\n        setFieldValue(name, value);\n        _onChange && _onChange(value, option);\n      },\n      onBlur: function onBlur(value) {\n        setFieldTouched(name);\n        _onBlur && _onBlur(value);\n      },\n      // setting undefined will show the placeholder\n      value: value === '' || value === null ? undefined : value\n    }, restProps), children);\n  });\n};\nexport default Select;\nSelect.Option = $Select.Option;\nSelect.OptGroup = $Select.OptGroup;"],"sourceRoot":""}