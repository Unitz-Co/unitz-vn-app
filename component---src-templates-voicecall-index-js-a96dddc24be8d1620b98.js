(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{JAtu:function(e,t,a){"use strict";a.r(t),a.d(t,"component",(function(){return _t}));var n,r,i=a("pMrf"),l=a("ERkP"),s=a.n(l),o=a("qtPF"),c=a("p0qn"),u=(a("dd5r"),a("Vgwz"),a("Wghe")),d=a("D57K"),m=a("uxIu"),p=a("oYC1"),f=function(e){var t=e.name,a=e.validate,n=e.fast,r=e.onChange,i=Object(d.a)(e,["name","validate","fast","onChange"]);return l.createElement(p.a,{name:t,validate:a,fast:n},(function(e){var a=e.field.value,n=e.form,s=n.setFieldValue,o=n.setFieldTouched;return l.createElement(m.a,Object.assign({value:a,onChange:function(e){s(t,null!=e?e.valueOf():e),o(t,!0),r&&r(e)}},i))}))},g=a("QA4e"),v=a("0eM1"),h=a("of1U"),b=a("A6W8"),y=a("j/s1");function S(e,t){return t||(t=e.slice(0)),e.raw=t,e}var x,C=y.a.div(n||(n=S(["\n  padding: 0 16px;\n  textarea.ant-input {\n    font-size: 16px;\n  }\n  textarea.ant-input::placeholder {\n    color: ",";\n    font-size: 16px;\n  }\n  .ant-input {\n    padding: 0.5rem 0.75rem;\n    border-radius: 0.5rem;\n    --tw-border-opacity: 1;\n    border-color: rgba(191, 205, 217, var(--tw-border-opacity));\n  }\n"])),b.a.colors.sub),E=y.a.div.attrs((function(e){return{halfSize:e.size?e.size/2+"px":"5px",size:e.size?e.size+"px":"10px",color:e.color?e.color:b.a.colors.border}}))(r||(r=S(["\n  position: relative;\n  overflow: hidden;\n  transform: translateY(50%) rotate(45deg) skewY(45deg) scaleX(0.5);\n  pointer-events: none;\n  & {\n    width: ",";\n    height: ",";\n  }\n\n  &::before,\n  &::after {\n    width: ",";\n    height: ",";\n  }\n  &::before,\n  &::after {\n    content: '';\n    position: absolute;\n    background: ",";\n    pointer-events: auto;\n  }\n  &::before {\n    transform: scaleX(1.155) skewY(-30deg) rotate(-30deg) translateY(-42.3%) skewX(30deg) scaleY(0.866) translateX(-24%);\n  }\n  &::after {\n    transform: scaleX(1.155) skewY(-30deg) rotate(-30deg) translateY(-42.3%) skewX(-30deg) scaleY(0.866) translateX(24%);\n  }\n\n  border-radius: 20%;\n  &::before {\n    border-radius: 20% 20% 20% 55%;\n  }\n\n  &::after {\n    border-radius: 20% 20% 55% 20%;\n  }\n  textarea::-webkit-resizer {\n    display: none;\n  }\n"])),(function(e){return e.size}),(function(e){return e.size}),(function(e){return e.size}),(function(e){return e.size}),(function(e){return e.color})),w=function(){return s.a.createElement(i.a,{className:"voiceCallFinish"},(function(e,t){return s.a.createElement(s.a.Fragment,null,s.a.createElement(C,null,s.a.createElement(u.a,{form:t.get("form")},s.a.createElement("section",{className:"py-0 bg-white min-lg:w-150 max-w-150 rounded-xl"},s.a.createElement("div",{className:"flex flex-col items-center p-6"},s.a.createElement("div",{className:"flex items-center"},s.a.createElement(h.a,{src:t.get("purchaseData.advisorProfile.avatarUrl"),size:32}),s.a.createElement("h1",{className:"mb-0 ml-2 text-base text-main"},t.get("purchaseData.advisorProfile.displayName"))),s.a.createElement("p",{className:"mt-4 mb-3 text-base font-normal"},t.apply("i18n.t","AdvisorVideoCall.finishDesc")),s.a.createElement(f,{count:5,name:"rating"}),s.a.createElement("label",{className:"mt-2 text-center text-main"},t.apply("i18n.t","RatingSuggestion.label"+t.get("form.values.rating")))),s.a.createElement("div",{className:"border-b border-divider"}),s.a.createElement("div",{className:"flex flex-col p-6 pb-0"},s.a.createElement("label",{className:"mb-2 text-base"},t.apply("i18n.t","AdvisorVideoCall.userReaction")),s.a.createElement("div",{className:"relative"},s.a.createElement(g.a.TextArea,{name:"note",rows:3,placeholder:t.apply("i18n.t","AdvisorVideoCall.finishNote")}),s.a.createElement("div",{className:"absolute p-1 rounded-lg pointer-events-none right-1px bottom-1px bg-white500"},s.a.createElement(E,{className:"",size:10,color:b.a.colors.border})))),s.a.createElement("div",{className:"flex flex-col justify-between p-6 space-y-4"},s.a.createElement(v.a,{onClick:t.get("form.submitForm"),size:"large",disabled:!t.get("canSubmit"),loading:t.get("form.isSubmitting"),type:"primary",block:!0},t.apply("i18n.t","AdvisorVoiceCall.finishReview")),s.a.createElement(v.a,{onClick:t.get("stepModel.handlers.callFinish"),size:"large",type:"text",name:"ink",ghost:!0,block:!0},t.apply("i18n.t","AdvisorVideoCall.exit")))))))}))};var N,T,_,A=y.a.div(x||(N=["\n  padding: 0 16px;\n  textarea.ant-input {\n    font-size: 16px;\n  }\n  textarea.ant-input::placeholder {\n    color: ",";\n    font-size: 16px;\n  }\n  .ant-input {\n    padding: 0.5rem 0.75rem;\n    border-radius: 0.5rem;\n    --tw-border-opacity: 1;\n    border-color: rgba(191, 205, 217, var(--tw-border-opacity));\n  }\n"],T||(T=N.slice(0)),N.raw=T,x=N),b.a.colors.sub),j=function(){return s.a.createElement(i.a,{className:"voiceCallMissed"},(function(e,t){return s.a.createElement(s.a.Fragment,null,s.a.createElement(A,null,s.a.createElement("section",{className:"py-0 bg-white min-lg:w-150 max-w-150 rounded-xl"},s.a.createElement("div",{className:"flex flex-col items-center min-lg:p-6 max-lg:py-6"},s.a.createElement("h2",{className:"mb-1 text-xl text-main"},t.apply("i18n.t","AdvisorVoiceCall.callStatus.missedLabel")),s.a.createElement("div",{className:"flex mt-1"},b.a.icons({name:"voice-call",fill:b.a.colors.brandb500,size:24,className:"mr-2"}),s.a.createElement("p",{className:"mb-0 text-base font-normal text-main"},t.get("purchaseData.bill.totalAfter"))),s.a.createElement("div",{className:"flex items-center justify-between w-full px-4 mt-4 min-lg:py-2 max-lg:py-1 min-lg:rounded-xl bg-red-lightest"},s.a.createElement("span",{className:"text-sub"},t.apply("i18n.t","AdvisorVideoCall.missCallText")),s.a.createElement(v.a,{onClick:t.get("stepModel.handlers.callAgain"),icon:b.a.icons({name:"voice-call",size:22,className:"inline-block mr-2"}),type:"link",name:"red"},t.apply("i18n.t","AdvisorVideoCall.reCall")))),s.a.createElement("div",{className:"border-b border-divider"}),s.a.createElement("div",{className:"flex flex-col items-center p-6"},s.a.createElement("div",{className:"flex items-center"},s.a.createElement(h.a,{src:t.get("purchaseData.advisorProfile.avatarUrl"),size:80}),s.a.createElement("div",{className:"flex flex-col ml-5"},s.a.createElement("h1",{className:"mb-1 text-xl font-medium"},t.get("purchaseData.advisorProfile.displayName")),s.a.createElement("div",{className:"flex items-center mb-1"},s.a.createElement("div",{className:"mr-2 -mb-1 text-base"},t.get("purchaseData.advisorProfile.rating.ratingText")),s.a.createElement(m.a,{disabled:!0,count:5,value:t.get("purchaseData.advisorProfile.rating.ratingScore")})),s.a.createElement("div",{className:"mb-2 uppercase text-sub text-xxs"},t.get("purchaseData.advisorProfile.reviewCount")," ",t.apply("i18n.t","Payment.Profile.reviews"))))),s.a.createElement("div",{className:"border-b border-divider"}),s.a.createElement("div",{className:"flex flex-row justify-between p-6 space-x-4"},s.a.createElement(v.a,{onClick:t.get("stepModel.handlers.callFinish"),size:"large",type:"primary",block:!0},t.apply("i18n.t","AdvisorVideoCall.finishSend"))))))}))};var O,k,M=y.a.div(_||(_=function(e,t){return t||(t=e.slice(0)),e.raw=t,e}(["\n  padding: 0 16px;\n  textarea.ant-input {\n    font-size: 16px;\n  }\n  textarea.ant-input::placeholder {\n    color: ",";\n    font-size: 16px;\n  }\n  .ant-input {\n    padding: 0.5rem 0.75rem;\n    border-radius: 0.5rem;\n    --tw-border-opacity: 1;\n    border-color: rgba(191, 205, 217, var(--tw-border-opacity));\n  }\n"])),b.a.colors.sub),L=function(){return s.a.createElement(i.a,{className:"voiceCallRejected"},(function(e,t){return s.a.createElement(s.a.Fragment,null,s.a.createElement(M,null,s.a.createElement("section",{className:"py-0 bg-white min-lg:w-150 max-w-150 rounded-xl"},s.a.createElement("div",{className:"flex flex-col items-center min-lg:p-6 max-lg:py-6"},s.a.createElement("h2",{className:"mb-1 text-xl text-main"},t.apply("i18n.t","AdvisorVoiceCall.callStatus.declinedLabel")),s.a.createElement("div",{className:"flex mt-1"},b.a.icons({name:"voice-call",fill:b.a.colors.brandb500,size:24,className:"mr-2"}),s.a.createElement("p",{className:"mb-0 text-base font-normal text-main"},t.get("purchaseData.bill.totalAfter"))),s.a.createElement("p",{className:"mt-2 mb-0 mr-2 text-4xl text-main"},t.apply("videoCallModel.getCallDurationTotal","")),s.a.createElement("div",{className:"flex items-center justify-between w-full px-4 py-2 mt-4 min-lg:rounded-xl bg-red-lightest"},s.a.createElement("span",{className:"text-sub"},t.apply("i18n.t","AdvisorVoiceCall.rejectCallText")),s.a.createElement(v.a,{onClick:t.get("stepModel.handlers.callAgain"),icon:b.a.icons({name:"voice-call",size:22,className:"inline-block mr-2"}),type:"link",name:"red"},t.apply("i18n.t","AdvisorVideoCall.reCall")))),s.a.createElement("div",{className:"border-b border-divider"}),s.a.createElement("div",{className:"flex flex-col items-center p-6"},s.a.createElement("div",{className:"flex items-center"},s.a.createElement(h.a,{src:t.get("purchaseData.advisorProfile.avatarUrl"),size:80}),s.a.createElement("div",{className:"flex flex-col ml-5"},s.a.createElement("h1",{className:"mb-1 text-xl font-medium"},t.get("purchaseData.advisorProfile.displayName")),s.a.createElement("div",{className:"flex items-center mb-1"},s.a.createElement("div",{className:"mr-2 -mb-1 text-base"},t.get("purchaseData.advisorProfile.rating.ratingText")),s.a.createElement(m.a,{disabled:!0,count:5,value:t.get("purchaseData.advisorProfile.rating.ratingScore")})),s.a.createElement("div",{className:"mb-2 uppercase text-sub text-xxs"},t.get("purchaseData.advisorProfile.reviewCount")," ",t.apply("i18n.t","Payment.Profile.reviews"))))),s.a.createElement("div",{className:"border-b border-divider"}),s.a.createElement("div",{className:"flex flex-row justify-between p-6 space-x-4"},s.a.createElement(v.a,{onClick:t.get("stepModel.handlers.callFinish"),size:"large",type:"primary",block:!0},t.apply("i18n.t","AdvisorVideoCall.finishSend"))))))}))},P=a("2srY"),z=a.n(P),V=(a("HiP7"),a("bVRK"),a("BmDy"));function F(e,t){return t||(t=e.slice(0)),e.raw=t,e}var I=y.a.div(O||(O=F(["\n  padding: 0 16px;\n  textarea.ant-input {\n    font-size: 16px;\n  }\n  textarea.ant-input::placeholder {\n    color: ",";\n    font-size: 16px;\n  }\n  .ant-input {\n    padding: 0.5rem 0.75rem;\n    border-radius: 0.5rem;\n    --tw-border-opacity: 1;\n    border-color: rgba(191, 205, 217, var(--tw-border-opacity));\n  }\n"])),b.a.colors.sub),D=y.a.div.attrs((function(e){return{halfSize:e.size?e.size/2+"px":"5px",size:e.size?e.size+"px":"10px",color:e.color?e.color:b.a.colors.border}}))(k||(k=F(["\n  position: relative;\n  overflow: hidden;\n  transform: translateY(50%) rotate(45deg) skewY(45deg) scaleX(0.5);\n  pointer-events: none;\n  & {\n    width: ",";\n    height: ",";\n  }\n\n  &::before,\n  &::after {\n    width: ",";\n    height: ",";\n  }\n  &::before,\n  &::after {\n    content: '';\n    position: absolute;\n    background: ",";\n    pointer-events: auto;\n  }\n  &::before {\n    transform: scaleX(1.155) skewY(-30deg) rotate(-30deg) translateY(-42.3%) skewX(30deg) scaleY(0.866) translateX(-24%);\n  }\n  &::after {\n    transform: scaleX(1.155) skewY(-30deg) rotate(-30deg) translateY(-42.3%) skewX(-30deg) scaleY(0.866) translateX(24%);\n  }\n\n  border-radius: 20%;\n  &::before {\n    border-radius: 20% 20% 20% 55%;\n  }\n\n  &::after {\n    border-radius: 20% 20% 55% 20%;\n  }\n  textarea::-webkit-resizer {\n    display: none;\n  }\n"])),(function(e){return e.size}),(function(e){return e.size}),(function(e){return e.size}),(function(e){return e.size}),(function(e){return e.color})),R=function(){return s.a.createElement(i.a,{className:"voiceCallRejected"},(function(e,t){return s.a.createElement(s.a.Fragment,null,s.a.createElement(I,null,s.a.createElement("section",{className:"py-0 bg-white min-lg:w-150 max-w-150 rounded-xl"},s.a.createElement("div",{className:"flex flex-col items-center min-lg:p-6 max-lg:py-6"},s.a.createElement("h2",{className:"mb-1 text-xl text-main"},t.apply("i18n.t","AdvisorVideoCall.callStatus.earlyEndLabel")),s.a.createElement("div",{className:"flex mt-1"},b.a.icons({name:"voice-call",fill:b.a.colors.brandb500,size:24,className:"mr-2"}),s.a.createElement("p",{className:"mb-0 text-base font-normal text-main"},t.get("purchaseData.bill.totalAfter"))),s.a.createElement("p",{className:"mt-2 mb-0 mr-2 text-4xl text-main"},t.get("transactionData.callPackageTime")),s.a.createElement("div",{className:"flex items-center justify-between w-full px-4 mt-4 min-lg:py-2 max-lg:py-1 min-lg:rounded-xl bg-red-lightest"},s.a.createElement("span",{className:"text-sub"},t.apply("i18n.t","AdvisorVideoCall.earlyEndCallText")),s.a.createElement(v.a,{onClick:t.get("stepModel.handlers.callAgain"),icon:b.a.icons({name:"voice-call",size:22,className:"inline-block mr-2"}),type:"link",name:"red"},t.apply("i18n.t","AdvisorVideoCall.reCall")))),s.a.createElement("div",{className:"border-b border-divider"}),s.a.createElement("div",{className:"flex flex-col items-center p-6"},s.a.createElement("div",{className:"flex items-center"},s.a.createElement(h.a,{src:t.get("purchaseData.advisorProfile.avatarUrl"),size:32}),s.a.createElement("h1",{className:"mb-0 ml-2 text-base text-main"},t.get("purchaseData.advisorProfile.displayName"))),s.a.createElement("p",{className:"mt-4 mb-3 text-base font-normal text-center"},t.apply("i18n.t","AdvisorVideoCall.finishDesc")),s.a.createElement(m.a,{count:5,value:t.get("form.values.rating"),onChange:function(e){t.apply("form.handleChange","rating")(e.toString())}})),s.a.createElement("div",{className:"border-b border-divider"}),s.a.createElement("div",{className:"flex flex-col p-6 pb-0"},s.a.createElement("label",{className:"mb-2 text-base"},t.apply("i18n.t","AdvisorVideoCall.userReaction")),s.a.createElement("div",{className:"relative"},s.a.createElement(V.a.TextArea,{rows:3,value:t.get("form.values.note"),placeholder:t.apply("i18n.t","AdvisorVideoCall.finishNote"),onChange:function(e){return t.apply("form.handleChange","note")(z()(e,"target.value",""))}}),s.a.createElement("div",{className:"absolute p-1 rounded-lg pointer-events-none right-1px bottom-1px bg-white500"},s.a.createElement(D,{className:"",size:10,color:b.a.colors.border})))),s.a.createElement("div",{className:"flex flex-row justify-between p-6 space-x-4"},s.a.createElement(v.a,{onClick:t.get("form.submitForm"),size:"large",disabled:!t.get("canSubmit"),loading:t.get("form.isSubmitting"),type:"primary",block:!0},t.apply("i18n.t","AdvisorVoiceCall.finishReview")),s.a.createElement(v.a,{onClick:t.get("stepModel.handlers.callFinish"),size:"large",type:"primary",block:!0},t.apply("i18n.t","AdvisorVideoCall.finishSend"))))))}))},U=a("Elws"),Y=function(){return s.a.createElement(i.a,{className:"pageContainer"},(function(e,t){return s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"fixed top-0 left-0 z-10 flex items-center justify-center w-screen h-screen bg-main"},s.a.createElement(i.a,{className:"completedSuccess"},(function(e,t){return s.a.createElement(s.a.Fragment,null,s.a.createElement(w,null))})),s.a.createElement(i.a,{className:"completedMissed"},(function(e,t){return s.a.createElement(s.a.Fragment,null,s.a.createElement(j,null))})),s.a.createElement(i.a,{className:"completedRejected"},(function(e,t){return s.a.createElement(s.a.Fragment,null,s.a.createElement(L,null))})),s.a.createElement(i.a,{className:"completedRating"},(function(e,t){return s.a.createElement(s.a.Fragment,null,s.a.createElement(U.a,null))})),s.a.createElement(i.a,{className:"completedEarlyEnd"},(function(e,t){return s.a.createElement(s.a.Fragment,null,s.a.createElement(R,null))}))))}))},X=a("kVkH"),B=a.n(X),q=a("VtSi"),H=a.n(q),K=(a("58i5"),a("4VHr"),a("0Q7h")),Z=a("XOlc"),Q=a("OIZT"),W=a("sKgL"),J=a("98Qs"),G=a("DKAj"),$=a("C6E7"),ee=a("WE89"),te=a("rjTG"),ae=a("g1Gz"),ne=a("A01W"),re=a("bzvT"),ie=a("ljKo"),le=a("L7b9"),se=a("lFOc");function oe(e,t,a,n,r,i,l){try{var s=e[i](l),o=s.value}catch(c){return void a(c)}s.done?t(o):Promise.resolve(o).then(n,r)}function ce(e){return function(){var t=this,a=arguments;return new Promise((function(n,r){var i=e.apply(t,a);function l(e){oe(i,n,r,l,s,"next",e)}function s(e){oe(i,n,r,l,s,"throw",e)}l(void 0)}))}}var ue,de=Object(o.a)({pageContainer:{rules:[["data",{data:{transaction:Object(o.c)((function(e){var t=z()(Object(K.a)(),"params.session_id","");return Object(ne.a)((function(){return Q.a.find('where: {session_id: {_eq: "'+t+'"}}',"\n                    service_pricing {\n                      detail {\n                        per_amount\n                        per_unit\n                        price_amount\n                        price_currency\n                        duration_amount: per_amount\n                        duration_unit: per_unit\n                      }\n                    }\n                    session_detail {\n                      duration_unit\n                      duration_amount\n                    }\n                    status_latest {\n                      status\n                    }\n                  ")}))})),transactionData:Object(o.c)((function(e){var t=Object(J.a)(e.get("transaction")),a=z()(t,"0"),n=$.a.statusLatest(e)(a),r=G.a.callPackageTimeMinute(e)(a);return{callPackage:G.a.callPackage(e)(a),callPackageTime:G.a.callPackageTime(e)(a),callPackagePrice:G.a.callPackagePrice(e)(a),callPackageTotal:G.a.callPackageTotal(e)(a),callPackageTimeMinute:r,statusLatest:n}})),purchaseData:Object(o.c)((function(e){var t=z()(Object(K.a)(),"params.purchase_id",""),a=Object(ae.a)(ce(H.a.mark((function e(){var a;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",null);case 2:return e.prev=2,e.next=5,Z.a.find('where: {id: {_eq: "'+t+'"}}',"\n                        id\n                        payments {\n                          amount\n                          type\n                        }\n                        services {\n                          id\n                          price_amount\n                          advisor_service {\n                            id\n                            service_id\n                            advisor {\n                              id\n                              profile {\n                                display_name\n                                avatar_url\n                              }\n                              review_agg {\n                                avg_score\n                              }\n                              reviews_aggregate {\n                                aggregate { count }\n                              }\n                            }\n                            service {\n                              name\n                              kind\n                              id\n                            }\n                            price {\n                              price_amount\n                              price_currency\n                              per_unit\n                              per_amount\n                            }\n                            discounts {\n                              percentage\n                              currency\n                              id\n                              amount\n                              type\n                            }  \n                          }\n                          \n                        }\n                        status {\n                          status\n                        }\n                        status_latest {\n                          status\n                        }\n                      ");case 5:return a=e.sent,e.abrupt("return",B()(a.toObject()));case 9:e.prev=9,e.t0=e.catch(2);case 11:case"end":return e.stop()}}),e,null,[[2,9]])}))),null,[t]),n=z()(a,"services.0.advisor_service"),r=z()(n,"advisor"),i=z()(n,"service"),l=z()(r,"profile"),s=z()(r,"reviews_aggregate.aggregate"),o=ee.a.amountPayment(e)(n);return{advisorProfile:{displayName:W.a.displayName(e)(l),avatarUrl:W.a.avatarUrl(e)(l),rating:{ratingText:W.a.reviewText(e)(r),ratingScore:W.a.reviewScore(e)(r)},reviewCount:W.a.reviewCount(e)(s)},status:te.a.getStatus(e)(a),bill:{totalAfter:z()(o,"totalAfter")?Object(re.c)(z()(o,"totalAfter")):0,totalBefore:z()(o,"totalBefore")?Object(re.c)(z()(o,"totalBefore")):0,discount:z()(o,"discount")?Object(re.c)(z()(o,"discount")):0},service:i}})),form:Object(o.c)((function(e){var t,a=z()(Object(K.a)(),"params.id",""),n=e.apply("authModel.getUserId");return Object(ie.e)({initialValues:{rating:5,note:""},onSubmit:(t=ce(H.a.mark((function t(r){return H.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,se.a.create({target_id:a,review_text:z()(r,"note",""),score:2*z()(r,"rating",0),created_by:n});case 3:return t.next=5,e.apply("stepModel.handlers.callFinish");case 5:t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),console.log(t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])}))),function(e){return t.apply(this,arguments)}),validationSchema:le.object().shape({rating:le.number().required(e.apply("i18n.t","Form.required"))})})})),canSubmit:Object(o.c)((function(e){return e.get("form.isValid")&&!e.get("form.isSubmitting")&&e.get("form.dirty")})),page:Object(o.c)((function(e){var t=s.a.useState(!1),a=t[0],n=t[1];return s.a.useEffect((function(){e.get("transactionData.callPackageTimeMinute")>=3&&!a&&n(!0)}),[e.get("transactionData.callPackageTimeMinute")]),{rating:a,$rating:n,handlers:{ratingFinish:function(){n(!1)}}}}))}}]]},isLoading:{rules:[["display",{display:Object(o.c)((function(e){return e.apply("loadingModel.isLoading")}))}]]},notLoading:{rules:[["display",{display:Object(o.c)((function(e){return!e.apply("loadingModel.isLoading")}))}]]},completedSuccess:{rules:[["display",{display:Object(o.c)((function(e){var t=z()(Object(K.a)(),"params.status");return!("incomplete"===e.get("transactionData.statusLatest")||t&&"completed"!==t||e.get("page.rating"))}))}]]},completedMissed:{rules:[["display",{display:Object(o.c)((function(e){return"missed"===z()(Object(K.a)(),"params.status")}))}]]},completedRejected:{rules:[["display",{display:Object(o.c)((function(e){return"rejected"===z()(Object(K.a)(),"params.status")}))}]]},completedEarlyEnd:{rules:[["display",{display:Object(o.c)((function(e){return"completed"===z()(Object(K.a)(),"params.status")&&"incomplete"===e.get("transactionData.statusLatest")}))}]]},completedRating:{rules:[["display",{display:Object(o.c)((function(e){return e.get("page.rating")}))}]]}})(Y),me=function(){return s.a.createElement(i.a,{className:"voiceCallConnecting"},(function(e,t){return s.a.createElement(s.a.Fragment,null,s.a.createElement("section",{className:"fixed absolute top-0 left-0 flex items-center justify-center w-full min-h-full py-0 bg-main"},s.a.createElement("article",{className:"absolute top-6 left-6 max-sm:hidden"},s.a.createElement("h1",{className:"mb-1 text-xl font-medium text-white"},t.get("@items.advisorProfile.displayName")),s.a.createElement("span",{className:"text-base text-white animate-pulse"},t.apply("i18n.t","AdvisorVideoCall.ringingStatusTxt"))),s.a.createElement("div",{className:"flex flex-col items-center"},s.a.createElement("div",{className:"absolute flex items-center justify-center rounded-full w-44 h-44 bg-white200 bg-opacity-40 animate-ping"},s.a.createElement("div",{className:"flex items-center justify-center bg-opacity-50 rounded-full w-36 h-36 bg-white300"},s.a.createElement("div",{className:"flex items-center justify-center rounded-full bg-opacity-70 w-28 h-28 bg-white400"}))),s.a.createElement(h.a,{className:"opacity-100",src:t.get("@items.advisorProfile.avatarUrl"),size:168}),s.a.createElement("article",{className:"flex flex-col items-center mt-10 max-w-xxs min-sm:hidden"},s.a.createElement("h1",{className:"mb-1 text-xl font-medium text-white"},t.get("@items.advisorProfile.displayName")),s.a.createElement("span",{className:"text-base text-center text-white animate-pulse"},t.apply("i18n.t","AdvisorVideoCall.ringingStatusTxt"))))))}))},pe=function(){return s.a.createElement(i.a,{className:"voiceCallIniting"},(function(e,t){return s.a.createElement(s.a.Fragment,null,s.a.createElement("section",{className:"fixed absolute top-0 left-0 flex items-center justify-center w-full min-h-full py-0 bg-main"},s.a.createElement("article",{className:"absolute top-6 left-6 max-sm:hidden"},s.a.createElement("h1",{className:"mb-1 text-xl font-medium text-white"},t.get("@items.advisorProfile.displayName")),s.a.createElement("span",{className:"text-base text-white animate-pulse"},t.apply("i18n.t","AdvisorVoiceCall.initingStatusTxt"))),s.a.createElement("div",{className:"flex flex-col items-center"},s.a.createElement("div",{className:"absolute flex items-center justify-center rounded-full w-44 h-44 bg-white200 bg-opacity-40 animate-ping"},s.a.createElement("div",{className:"flex items-center justify-center bg-opacity-50 rounded-full w-36 h-36 bg-white300"},s.a.createElement("div",{className:"flex items-center justify-center rounded-full bg-opacity-70 w-28 h-28 bg-white400"}))),s.a.createElement(h.a,{className:"opacity-100",src:t.get("@items.advisorProfile.avatarUrl"),size:168}),s.a.createElement("article",{className:"flex flex-col items-center mt-10 min-sm:hidden"},s.a.createElement("h1",{className:"mb-1 text-xl font-medium text-white"},t.get("@items.advisorProfile.displayName")),s.a.createElement("span",{className:"text-base text-center text-white animate-pulse"},t.apply("i18n.t","AdvisorVoiceCall.initingStatusTxt"))))))}))},fe=a("I/dS"),ge=function(){return s.a.createElement(i.a,{className:"voiceCallOnProgress"},(function(e,t){return s.a.createElement(s.a.Fragment,null,s.a.createElement("section",{className:"fixed z-10 py-0 bg-transparent top-6 left-6"},s.a.createElement("article",null,s.a.createElement("h1",{className:"flex flex-row mb-1 text-xl font-medium text-white"},t.get("@items.advisorProfile.displayName")," ",b.a.icons({name:t.apply("voiceCallModel.useState","otherState.micMute")?"micro-off":"micro",fill:b.a.colors.white500,size:12})),s.a.createElement(fe.a,{interval:1e3},(function(){return s.a.createElement("span",{className:"text-base text-white animate-pulse"},t.apply("i18n.t","AdvisorInCome.inComeTextPackage",{num:t.apply("voiceCallModel.getCallMaxDuration")})," ","/ ",t.apply("voiceCallModel.getCallDuration"))})))))}))},ve=a("//nZ"),he=a.n(ve),be=a("nnRT"),ye=a.n(be),Se=(a("Hfs8"),a("+Cos")),xe=(a("CFFa"),a("j6Rw")),Ce=a.n(xe),Ee=a("O94r"),we=a.n(Ee),Ne=a("0/Rv");var Te=y.a.div(ue||(ue=function(e,t){return t||(t=e.slice(0)),e.raw=t,e}(["\n  &.fixed-position {\n    transform: none !important;\n    cursor: default !important;\n  }\n"]))),_e=function(e){var t=e.children,a=e.className;!function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a])}(e,["children","className"]);return s.a.createElement(i.a,null,(function(e,n){return s.a.createElement(s.a.Fragment,null,s.a.createElement(Ne.a,{sm:{normal:{top:12,right:12,width:120,height:150},collapse:{top:z()(n.apply("LAYOUT.getLayout","AdvisorVideoCallStatus"),"height",0)/2,right:0,width:z()(n.apply("LAYOUT.getLayout","AdvisorVideoCallStatus"),"width",0),height:z()(n.apply("LAYOUT.getLayout","AdvisorVideoCallStatus"),"height",0)/2}},md:{normal:{top:46,right:46,width:190,height:106},collapse:{top:0,right:0,width:z()(n.apply("LAYOUT.getLayout","AdvisorVideoCallStatus"),"width",0)/2,height:z()(n.apply("LAYOUT.getLayout","AdvisorVideoCallStatus"),"height",0)}},lg:{normal:{top:46,right:46,width:190,height:106},collapse:{top:0,right:0,width:z()(n.apply("LAYOUT.getLayout","AdvisorVideoCallStatus"),"width",0)/2,height:z()(n.apply("LAYOUT.getLayout","AdvisorVideoCallStatus"),"height",0)}}},(function(r){var i=z()(r,"width",190),l=z()(r,"height",106),o=z()(r,"top",46),c=z()(r,"right",46);return s.a.createElement("div",{style:Object.assign({position:"absolute",top:o,right:c,zIndex:5,width:i,height:l},z()(r,"normal",{}),n.apply("voiceCallModel.useState","myState.videoMute")?{height:0}:{},n.apply("voiceCallModel.useState","myState.collapse")?{}:Object.assign({top:0,right:0,bottom:0,width:z()(n.apply("LAYOUT.getLayout","AdvisorVoiceCallStatus"),"width",0)/2,height:z()(n.apply("LAYOUT.getLayout","AdvisorVoiceCallStatus"),"height",0)},z()(r,"collapse",{})))},s.a.createElement(Ce.a,{axis:"both",handle:".drag-handle",defaultPosition:{x:0,y:0},position:null,grid:[8,8],scale:1,bounds:{top:-o,right:c,bottom:z()(n.apply("LAYOUT.getLayout","AdvisorVoiceCallStatus"),"height",0)-o-l,left:0-(z()(n.apply("LAYOUT.getLayout","AdvisorVoiceCallStatus"),"width",0)-c-i)},disabled:!n.apply("voiceCallModel.useState","myState.collapse")},s.a.createElement(Te,Object.assign({className:we()(a,"w-full h-full drag-handle bg-transparent",{"cursor-move":n.apply("voiceCallModel.useState","myState.collapse"),"fixed-position":!n.apply("voiceCallModel.useState","myState.collapse")})},e),t)))})))}))},Ae=Object(Se.a)((function(){return Promise.all([a.e(3),a.e(55)]).then(a.bind(null,"TCjZ"))})),je=Object(Se.a)((function(){return Promise.all([a.e(3),a.e(54)]).then(a.bind(null,"gZ/n"))})),Oe=Object(Se.a)((function(){return Promise.all([a.e(3),a.e(56)]).then(a.bind(null,"iQLX"))})),ke=Object(Se.a)((function(){return Promise.all([a.e(3),a.e(57)]).then(a.bind(null,"7K1I"))}));function Me(e,t){return ye()(e.layout,t.layout)}var Le=s.a.memo((function(e){var t=e.voiceCallModel,a=e.layout;return"undefined"==typeof window?null:s.a.createElement(i.a,{forceCtx:!0},(function(e,n){return s.a.createElement(s.a.Fragment,null,s.a.createElement(Ae,n.get("tokbox"),s.a.createElement(_e,null,s.a.createElement(je,{className:"w-full h-full bg-transparent",properties:{cameraPosition:t.useState("cameraPosition"),publishAudio:!t.useState("myState.micMute"),publishVideo:!1,width:"100%",height:"100%",showControls:!1,style:{backgroundImageURI:n.get("@items.userProfile.avatarUrl")}},eventHandlers:{error:function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];console.log("error",t)},otrnError:function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];console.log("otrnError",t)}}})),s.a.createElement("div",{style:Object.assign({},he()(a,["width","height"]))},s.a.createElement(Oe,null,s.a.createElement("div",{className:"absolute bg-transparent",style:Object.assign({},he()(a,["width","height"]),n.apply("voiceCallModel.useState","myState.collapse")?{}:{left:0,top:0,width:a.width/2,height:a.height})},s.a.createElement(ke,Object.assign({className:"w-full h-full bg-transparent"},n.get("tokboxSubscriber"),{properties:{showControls:!1,height:"100%",width:"100%",style:{backgroundImageURI:n.get("@items.advisorProfile.avatarUrl")}}})))))))}))}),Me),Pe=function(){return s.a.createElement(i.a,{className:"callSession"},(function(e,t){return s.a.createElement(s.a.Fragment,null,t.apply("LAYOUT.useLayout",{layout:"AdvisorVoiceCallStatus"},(function(e){var a=e.layout;if(!a)return null;if(!t.get("tokbox.sessionId"))return null;var n=t.get("voiceCallModel");return s.a.createElement(Le,{voiceCallModel:n,layout:a,advisorAvatarUrl:t.get("@items.advisorProfile.avatarUrl"),userAvatarUrl:t.get("@items.userProfile.avatarUrl")})})))}))};var ze=function(e){var t=e.className,a=e.icon,n=e.text,r=e.horizontal,i=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,["className","icon","text","horizontal"]);return s.a.createElement("div",Object.assign({},i,{className:"flex items-center justify-center cursor-pointer text-white500 "+(r?"flex-row":"flex-col")+" "+t}),a,!!n&&s.a.createElement("div",{className:"mb-0 font-light text-normal"},n))},Ve=function(){return s.a.createElement(i.a,{className:"voiceCallConnecting"},(function(e,t){return s.a.createElement(s.a.Fragment,null,s.a.createElement("section",{className:we()("absolute bottom-0 z-10 flex justify-between w-full min-lg:px-6 max-lg:px-4 py-4 transition-transform duration-100 ease-in-out transform max-lg:flex-col bg-black400 bg-opacity-70")},s.a.createElement("div",{className:"relative flex justify-between max-lg:hidden w-36"}),s.a.createElement("div",{className:"flex justify-between p-0 min-lg:w-52 max-lg:w-full"},s.a.createElement("div",{className:"flex flex-col items-center flex-1"},s.a.createElement(ze,{className:we()("w-12 h-12 rounded-full",{"bg-white500":t.apply("voiceCallModel.useState","myState.micMute")},{"bg-white200 bg-opacity-30":!t.apply("voiceCallModel.useState","myState.micMute")}),onClick:function(){t.apply("voiceCallModel.toggleMic")},icon:b.a.icons({name:t.apply("voiceCallModel.useState","myState.micMute")?"micro-off":"micro",fill:t.apply("voiceCallModel.useState","myState.micMute")?b.a.colors.main:b.a.colors.white500,size:24})}),s.a.createElement("span",{className:"mt-2 text-white min-lg:hidden"},t.apply("i18n.t","AdvisorVideoReceiver."+(t.apply("voiceCallModel.useState","myState.micMute")?"microOn":"microOff")))),s.a.createElement("div",{className:"flex flex-col items-center flex-1"},s.a.createElement(ze,{onClick:function(){t.apply("voiceCallModel.endCall")},className:"w-12 h-12 rounded-full bg-red ",icon:b.a.icons({name:"call-end",fill:b.a.colors.white500,size:24})}),s.a.createElement("span",{className:"mt-2 text-white min-lg:hidden"},t.apply("i18n.t","AdvisorVideoReceiver.endCall")))),s.a.createElement("div",{className:"flex justify-between w-36 max-lg:hidden"})))}))},Fe=function(){return s.a.createElement(i.a,{className:"voiceComponent"},(function(e,t){return s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"drag-bounds",style:{position:"fixed",zIndex:-100,top:0,left:0,width:z()(t.apply("LAYOUT.getLayout","AdvisorVoiceCallStatus"),"width",0),height:z()(t.apply("LAYOUT.getLayout","AdvisorVoiceCallStatus"),"height",0),background:"transparent"}}),s.a.createElement(Pe,null),s.a.createElement(pe,null),s.a.createElement(me,null),s.a.createElement(ge,null))}))},Ie=a("fBwi"),De=a.n(Ie),Re=(a("586z"),a("g00u")),Ue=a.n(Re),Ye=a("EX5Z"),Xe=a.n(Ye),Be=a("O8WD"),qe=a("lFZc"),He=a.n(qe),Ke=a("wgY5"),Ze=a.n(Ke),Qe=a("V3Bs"),We={connected:"connected",reconnecting:"reconnecting",disconnect:"disconnect"};function Je(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Ge=function(){function e(e,t){var a;this._local={ctx:null};var n=e.id,r=e.user_id,i=e.advisor_id,l=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,["id","user_id","advisor_id"]);Object.assign(this,Object.assign({states:{voiceCallConnecting:!1,voiceCallReject:!1,voiceCallComplete:!1,isNoAnswer:!1,startTime:0,endTime:0,heartbeat:0},sessionData:{},user_id:r,advisor_id:i,session_id:n,peerStates:(a={},a[r]={micMute:!1,videoMute:!1,cameraPosition:"",collapse:!0,internetStatus:We.connected,startTime:0,endTime:0,heartbeat:0},a[i]={micMute:!1,videoMute:!1,cameraPosition:"",collapse:!0,internetStatus:We.connected,startTime:0,endTime:0,heartbeat:0},a)},l)),this._local.ctx=t}var t,a,n;return e.prototype.onConnect=function(e){e.once("onDestroy",Object(Qe.a)(this._local.ctx,this)(e,{docId:this.session_id,collectionName:"voicecalls"}))},t=e,(a=[{key:"myState",get:function(){return this.peerStates[this.uid]}},{key:"otherState",get:function(){return this.peerStates[this.oid]}},{key:"peerState",get:function(){return this.peerStates[this.uid]}},{key:"uid",get:function(){return this._local.ctx.apply("authModel.getUserId")}},{key:"oid",get:function(){var e=this.user_id,t=this.advisor_id;return this.uid===e?t:e}}])&&Je(t.prototype,a),n&&Je(t,n),e}();function $e(e,t,a,n,r,i,l){try{var s=e[i](l),o=s.value}catch(c){return void a(c)}s.done?t(o):Promise.resolve(o).then(n,r)}function et(e){return function(){var t=this,a=arguments;return new Promise((function(n,r){var i=e.apply(t,a);function l(e){$e(i,n,r,l,s,"next",e)}function s(e){$e(i,n,r,l,s,"throw",e)}l(void 0)}))}}function tt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function at(e,t){return(at=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var nt=function(){function e(){this.items={}}var t=e.prototype;return t.add=function(e){var t=e.get("id");if(!t)return null;this.items[t]=e},t.get=function(e){return this.items[e]},e}(),rt=function(e){var t,a;function n(){for(var t,a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];(t=e.call.apply(e,[this].concat(r))||this).state={callState:n.CALL_STATES.voiceCallIniting,videoMute:!1,cameraPosition:"front",startTime:null,msg:"",remoteState:{videoMute:!1},localState:{videoMute:!1}},t.constructor.initState(tt(t));var l,s,o=new He.a;return t.set({stream:o,resolvers:{user:(s=et(H.a.mark((function e(){var a;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.get("user_id"),console.log("user_id",a),e.abrupt("return",{id:a});case 3:case"end":return e.stop()}}),e)}))),function(){return s.apply(this,arguments)}),advisor:(l=et(H.a.mark((function e(){var a;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.get("advisor_id"),console.log("advisor_id",a),e.abrupt("return",{id:a});case 3:case"end":return e.stop()}}),e)}))),function(){return l.apply(this,arguments)})}}),o.on("notify",function(){var e=et(H.a.mark((function e(a){var n;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=setTimeout((function(){o.emit("notify",a)}),2e3),t.set({notifTimer:n});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),o.on("stopNotify",et(H.a.mark((function e(){var a;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(a=t.get("notifTimer"))&&(clearTimeout(a),t.set({notifTimer:null}));case 2:case"end":return e.stop()}}),e)})))),t.useEffect((function(){t.hasCallState(n.CALL_STATES.voiceCallTaking)&&(t.startCall(),t.startTimer())}),(function(){return[t.getCallState()]})),t.useEffect((function(){t.getState("states.startTime")&&t.hasCallState(n.CALL_STATES.voiceCallConnecting)&&(t.startCall(),t.startTimer())}),(function(){return[t.getState("states.startTime")]})),t.useEffect((function(){t.getState("states.endTime")&&t.getState("states.voiceCallComplete")&&!t.hasCallState(n.CALL_STATES.voiceCallFinish)&&t.setState({endTime:Ze()(),callState:n.CALL_STATES.voiceCallFinish})}),(function(){return[t.getState("states.endTime"),t.getState("states.voiceCallComplete")]})),t.state.once("onDestroy",(function(){t.isMounted=!1,t.stopNotifySession(),console.log("getCallState",t.getCallState()),(t.hasCallState(n.CALL_STATES.voiceCallConnecting)||t.hasCallState(n.CALL_STATES.voiceCallIncomming)||t.hasCallState(n.CALL_STATES.voiceCallIniting))&&t.setState("states.voiceCallReject",!0)})),t}a=e,(t=n).prototype=Object.create(a.prototype),t.prototype.constructor=t,at(t,a),n.create=function(e,t){console.log("voice create");var a=new n,r=z()(e,"data.session_id");return a.set(Object.assign({},t,{msg:e,id:r})),this.instances.add(a),a},n.fromMessage=function(e,t){var a=z()(e,"data.session_id")||z()(e,"id"),n=this.instances.get(a);n||(n=this.create(e));var r=z()(e,"data.user_id"),i=z()(e,"data.advisor_id"),l=z()(e,"data.service_id"),s=z()(e,"data.session_id");return r&&i&&l&&s&&(n.set({user_id:r,advisor_id:i,service_id:l,session_id:s}),n.connectStore(t)),n.ctx=t,n},n.fromSession=function(){var e=et(H.a.mark((function e(t){var a,r,i;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.user_id,r=t.advisor_id,e.prev=1,e.next=4,n.create({user_id:a,advisor_id:r});case 4:return i=e.sent,e.next=7,i.createSession();case 7:return e.abrupt("return",i);case 10:e.prev=10,e.t0=e.catch(1),console.log("ererer",e.t0);case 13:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(t){return e.apply(this,arguments)}}(),n.fromCall=function(e){try{var t=n.create();return t.set(e),t}catch(a){console.log("ererer",a)}};var r=n.prototype;return r.connectStore=function(e){var t=this.get("session_id"),a=this.get("user_id"),n=this.get("advisor_id"),r=this.get("service_id");this.state.enhance(new Ge({id:t,user_id:a,advisor_id:n,service_id:r},e)),console.log("connectStore",e)},r.getSectionId=function(){var e=this.get("msg");return z()(e,"data.session_id")},r.getSectionToken=function(){var e=this.get("msg");return z()(e,"data.session_token")},r.getSectionKey=function(){var e=this.get("msg");return z()(e,"data.session_key")},r.createSession=function(){var e=et(H.a.mark((function e(t){var a,r,i,l,s,o;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({msg:"AdvisorVoiceCall.initingStatusTxt"}),console.log("createSession",t),e.prev=2,a=this.get("user_id"),r=this.get("advisor_id"),i=this.get("service_id"),l=this.get("purchase_id"),s={user_id:a,advisor_id:r,service_id:i,purchase_id:l},e.next=10,Ue.a.getClient().post("tasks-createSession",s);case 10:if(o=e.sent,console.log({data:o,params:s}),!(z()(o,"message.length",0)>0)){e.next=14;break}return e.abrupt("return",this.setState({msg:{text:z()(o,"message")}}));case 14:return this.set("session_id",z()(o,"session_id")),this.connectStore(t),this.ctx=t,this.set({msg:{data:o}}),this.setState({msg:"AdvisorVoiceCall.ringingStatusTxt",callState:n.CALL_STATES.voiceCallConnecting}),e.abrupt("return",o);case 22:e.prev=22,e.t0=e.catch(2),console.log("create session error",e.t0),this.setState({msg:{text:e.t0.toString()}});case 26:case"end":return e.stop()}}),e,this,[[2,22]])})));return function(t){return e.apply(this,arguments)}}(),r.notifySession=function(){var e=et(H.a.mark((function e(){var t,a;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.set({stopNotifySession:!1}),t=this.get("msg"),a=z()(t,"data.session_id"),this.set({notifId:a,msg:t}),this.get("stream").emit("notify",t),this.watchNotifTimeout();case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),r.stopNotifySession=function(){var e=et(H.a.mark((function e(){return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.set({stopNotifySession:!0}),this.get("stream").emit("stopNotify");case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),r.watchNotifTimeout=function(){var e=this,t=this.get("notifId"),a="notifListener."+t;if(!this.get(a)){var n=Xe.a.getClient().firestore().collection("videocalls").doc(t),r=[];r.push(n.onSnapshot((function(t){var a=t.data();z()(a,"states.isNoAnswer")&&e.stopNotifySession()}))),r.push(this.get("stream").on("stopNotify",(function(){r.map((function(e){return e()})),r.splice(0,r.length)}))),this.set(a,!0)}},r.switchCamera=function(){var e=["front","back"],t=this.getState("cameraPosition"),a=e[(De()(e,t)+1)%e.length];this.setState("myState.cameraPosition",a),this.setState({cameraPosition:a})},r.toggleMic=function(){this.setState("myState.micMute",!this.getState("myState.micMute"))},r.toggleVideo=function(){this.setState("myState.videoMute",!this.getState("myState.videoMute"))},r.toggleVideoSubscriber=function(){this.setState("remoteState.videoMute",!this.getState("remoteState.videoMute"))},r.collapseVideo=function(){this.setState("myState.collapse",!0)},r.separateVideo=function(){this.setState("myState.collapse",!1)},r.reConnecting=function(){this.setState("myState.internetStatus",n.INTERNET_STATES.reconnecting)},r.reConnected=function(){this.setState("myState.internetStatus",n.INTERNET_STATES.connected)},r.disConnected=function(){this.getCallState()!==n.CALL_STATES.voiceCallFinish&&this.setState("myState.internetStatus",n.INTERNET_STATES.disconnect)},r.isConnected=function(){return this.useState("myState.internetStatus")===n.INTERNET_STATES.connected&&this.useState("otherState.internetStatus")===n.INTERNET_STATES.connected},r.isConnecting=function(){return this.useState("myState.internetStatus")===n.INTERNET_STATES.reconnecting||this.useState("otherState.internetStatus")===n.INTERNET_STATES.reconnecting},r.isDisconnected=function(){return this.useState("myState.internetStatus")===n.INTERNET_STATES.disconnect},r.startCall=function(){var e=et(H.a.mark((function e(t){return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setState({callState:n.CALL_STATES.voiceCallOnProgress});case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r.takeCall=function(){this.stopNotifySession(),this.setState({callState:n.CALL_STATES.voiceCallTaking})},r.startTimer=function(){this.getState("states.startTime")||this.setState("states.startTime",Ze()().valueOf()),this.setState({startTime:Ze()(this.getState("states.startTime"))})},r.endCall=function(){this.hasCallState(n.CALL_STATES.voiceCallConnecting)||this.hasCallState(n.CALL_STATES.voiceCallIncomming)?this.setState("states.voiceCallReject",!0):(this.setState("states.endTime",Ze()().valueOf()),this.setState("states.voiceCallComplete",!0))},r.startIncomingCall=function(){this.setState({callState:n.CALL_STATES.voiceCallIncomming})},r.rejectCall=function(){this.setState("states.voiceCallReject",!0)},r.getCallState=function(){var e=this.useState("callState");return console.log("---hasCallState",e),e},r.hasCallState=function(e){return this.getCallState()===e},r.getCallDuration=function(){var e=this.useState("startTime");if(!e)return"";var t=Ze()(),a=Ze.a.duration(t.diff(e));return Object(re.b)(a.asMilliseconds())},r.getCallDurationTotal=function(e){void 0===e&&(e="MM");var t=this.getState("startTime"),a=this.getState("endTime");if(!t||!a)return"";var n=Ze.a.duration(a.diff(t));return Object(re.b)(n.asMilliseconds())},r.getCallMaxDuration=function(){var e=this.get("msg"),t=z()(e,"data.session_duration"),a=Ze.a.duration(t,"seconds");return Object(re.b)(a.asMilliseconds())},n.onForegroundEvent=function(){var e=et(H.a.mark((function e(t){return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.type,t.detail;case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.onBackgroundEvent=function(){var e=et(H.a.mark((function e(t){return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.type,t.detail;case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n}(Be.a);rt.instances=new nt,rt.CALL_STATES={voiceCallConnecting:"voiceCallConnecting",voiceCallOnProgress:"voiceCallOnProgress",voiceCallIncomming:"voiceCallIncomming",voiceCallFinish:"voiceCallFinish",voiceCallIniting:"voiceCallIniting",voiceCallTaking:"voiceCallTaking",voiceCallReject:"voiceCallReject"},rt.INTERNET_STATES=Object.assign({},We);var it=rt,lt=Object(o.a)({voiceComponent:{rules:[["data",{data:{}}]]},voiceCallIniting:{rules:[["display",{display:Object(o.c)((function(e){return e.apply("voiceCallModel.hasCallState",it.CALL_STATES.voiceCallIniting)}))}]]},voiceCallConnecting:{rules:[["display",{display:Object(o.c)((function(e){return e.apply("voiceCallModel.hasCallState",it.CALL_STATES.voiceCallConnecting)}))}]]},voiceCallIncomming:{rules:[["display",{display:Object(o.c)((function(e){return e.apply("voiceCallModel.hasCallState",it.CALL_STATES.voiceCallIncomming)}))}]]},voiceCallTaking:{rules:[["display",{display:Object(o.c)((function(e){return e.apply("voiceCallModel.hasCallState",it.CALL_STATES.voiceCallTaking)}))}]]},voiceCallOnProgress:{rules:[["display",{display:Object(o.c)((function(e){return e.apply("voiceCallModel.hasCallState",it.CALL_STATES.voiceCallOnProgress)&&e.apply("voiceCallModel.isConnected")}))}]]},voiceCallOnProgressOffCamera:{rules:[["display",{display:Object(o.c)((function(e){return e.apply("voiceCallModel.hasCallState",it.CALL_STATES.voiceCallOnProgress)&&!(e.apply("voiceCallModel.useState","remoteState.voiceMute")&&e.apply("voiceCallModel.isConnected"))}))}]]},voiceCallDisconnect:{rules:[["display",{display:Object(o.c)((function(e){return e.apply("voiceCallModel.hasCallState",it.CALL_STATES.voiceCallFinish)&&e.apply("voiceCallModel.isDisconnected")}))}]]},sessionReconnect:{rules:[["display",{display:Object(o.c)((function(e){return e.apply("voiceCallModel.isConnecting")}))}]]},callSession:{rules:[["display",{display:Object(o.c)((function(e){return!e.apply("voiceCallModel.hasCallState",it.CALL_STATES.voiceCallFinish)}))}]]}})(Fe),st=function(){return s.a.createElement(i.a,{className:"voicePage"},(function(e,t){return s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{ref:t.apply("LAYOUT.onLayout","AdvisorVoiceCallStatus"),className:"fixed top-0 left-0 z-10 w-screen h-screen bg-gray-400"},s.a.createElement(lt,null),s.a.createElement(i.a,{className:"sectionVoiceActions"},(function(e,t){return s.a.createElement(s.a.Fragment,null,s.a.createElement(Ve,null))}))))}))},ot={getTokboxConfig:function(){return function(e){var t={};return{apiKey:e.getSectionKey(),sessionId:e.getSectionId(),token:e.getSectionToken(),signal:{data:"data",type:"init",to:""},ref:function(e){t.ref=e},eventHandlers:{sessionConnected:function(e){console.log("sessionConnected, caller",e),setInterval((function(){t.ref&&t.ref.signal({type:"healthcheck"})}),5e3)},sessionDisconnected:function(t){console.log("disconnected",t,t.connectionId),e.disConnected()},sessionReconnected:function(t){console.log("sessionReconnected",t),e.reConnected()},sessionReconnecting:function(t){console.log("sessionReconnecting",t),e.reConnecting()},streamCreated:function(t){console.log("streamCreated",t),e.startCall(t.connectionId),e.startTimer()},connectionCreated:function(t){console.log("connectionCreated",t.connectionId),e.startCall(t.connectionId),e.startTimer()},connectionDestroyed:function(t){console.log("connectionDestroyed",t),e.endCall()},signal:function(e){console.log("signal",e)}}}}},getTokboxSubscriberConfig:function(){return function(e){return{eventHandlers:{videoDisabled:function(){e.toggleVideoSubscriber()},videoEnabled:function(){e.toggleVideoSubscriber()}}}}}},ct=a("O+QE");function ut(e,t,a,n,r,i,l){try{var s=e[i](l),o=s.value}catch(c){return void a(c)}s.done?t(o):Promise.resolve(o).then(n,r)}function dt(e){return function(){var t=this,a=arguments;return new Promise((function(n,r){var i=e.apply(t,a);function l(e){ut(i,n,r,l,s,"next",e)}function s(e){ut(i,n,r,l,s,"throw",e)}l(void 0)}))}}var mt=Object(o.a)({voicePage:{rules:[["data",{data:{"@params":Object(o.c)((function(e){var t=Object(K.a)(),a=z()(t,"params",{}),n=z()(a,"id"),r=z()(a,"service_id",""),i=z()(a,"purchase_id","");return{advisor_id:n,service_id:r,user_id:e.apply("authModel.getUserId"),purchase_id:i}})),voiceCallModel:Object(o.c)((function(e){var t=e.get("@params.advisor_id"),a=s.a.useMemo((function(){var t=it.fromCall(e.get("@params"),e);return t.createSession(e),t}),[t]);return a.hookState(),a.useEffect((function(){a.getState("states.voiceCallReject")&&e.apply("@page.onCompleted","rejected")}),(function(){return[a.getState("states.voiceCallReject")]})),a.useEffect((function(){a.getState("states.isNoAnswer")&&e.apply("@page.onCompleted","missed")}),(function(){return[a.getState("states.isNoAnswer")]})),a.useEffect((function(){a.hasCallState(it.CALL_STATES.voiceCallFinish)&&e.apply("@page.onCompleted","completed")}),(function(){return[a.getCallState()]})),a})),tokbox:Object(o.c)((function(e){var t=e.get("voiceCallModel");return ot.getTokboxConfig(e)(t)})),tokboxSubscriber:Object(o.c)((function(e){var t=e.get("voiceCallModel");return ot.getTokboxSubscriberConfig(e)(t)})),"@items":Object(o.c)((function(e){var t=e.get("@params"),a=t.advisor_id,n=t.service_id,r=(t.user_id,Object(ae.a)(dt(H.a.mark((function e(){var t;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a){e.next=2;break}return e.abrupt("return",null);case 2:return e.prev=2,e.next=5,ct.a.find('where: {id: {_eq:"'+a+'"}}','services(where: {id: {_eq: "'+n+'"}}) {\n                        price {\n                          per_unit\n                          per_amount\n                          price_currency\n                          price_amount\n                        \n                          \n                        }\n                        id\n                        service {\n                          id\n                          name\n                          \n                        }\n                      }\n                      profile {\n                        id\n                        display_name\n                        avatar_url\n                        created_at\n                      }\n                      reviews {\n                        id\n                        review_text\n                        score\n                        updated_at\n                        author {\n                          profile {\n                            avatar_url\n                            display_name\n                            id\n                          }\n                        }\n                      } review_agg {\n                        avg_score\n                      } ');case 5:return t=e.sent,e.abrupt("return",t.toObject());case 9:e.prev=9,e.t0=e.catch(2);case 11:case"end":return e.stop()}}),e,null,[[2,9]])}))),null,[a])),i=z()(r,"0"),l=z()(r,"0.services.0"),s=z()(r,"0.profile");return{id:a,service_id:n,advisorProfile:{id:W.a.profileId(e)(s),displayName:W.a.displayName(e)(s),avatarUrl:W.a.avatarUrl(e)(s),rating:{ratingText:W.a.reviewText(e)(i),ratingScore:W.a.reviewScore(e)(i)}},price:{pricePerMinTxt:W.a.pricePerMin(e)(l),pricePerMinTitle:W.a.pricePerMinTitle(e)(l)}}})),isCalling:Object(o.c)((function(e){return e.apply("voiceCallModel.hasCallState",it.CALL_STATES.voiceCallOnProgress)})),"@page":Object(o.c)((function(e){var t=Object(K.a)();return{onCompleted:function(a){var n=e.get("voiceCallModel").getSectionId(),r=e.get("@params"),i=r.purchase_id,l={advisor_id:r.advisor_id,purchase_id:i,session_id:n,step:"completed",status:a||"completed"},s=t.redirectUrl(l,{origin:!1});t.navigate(s,{relace:!0,state:{purchase_id:i}}),t.setRouteState(l),e.apply("stepModel.setStep",l.step)}}})),purchaseData:Object(o.c)((function(e){var t=e.get("@params").purchase_id,a=Object(ae.a)(dt(H.a.mark((function e(){var a;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",null);case 2:return e.prev=2,e.next=5,Z.a.find('where: {id: {_eq: "'+t+'"}}',"\n                      services {\n                        id\n                        price_amount\n                      }\n                      discounts {\n                        currency\n                        percentage\n                        amount\n                        id\n                        type\n                      }\n                      ");case 5:return a=e.sent,e.abrupt("return",a.toObject());case 9:e.prev=9,e.t0=e.catch(2);case 11:case"end":return e.stop()}}),e,null,[[2,9]])}))),null,[t]),n=ee.a.amountPayment(e)({price:{price_amount:z()(a,"0.services.0.price_amount")},discounts:z()(a,"0.discounts")});return{totalAfter:z()(n,"totalAfter")?Object(re.c)(z()(n,"totalAfter")):0,totalBefore:z()(n,"totalBefore")?Object(re.c)(z()(n,"totalBefore")):0,discount:z()(n,"discount")?Object(re.c)(z()(n,"discount")):0}}))}}]]},sectionVoiceActions:{rules:[["display",{display:Object(o.c)((function(e){return!0}))}]]},voiceCallFinish:{rules:[["display",{display:Object(o.c)((function(e){return e.apply("voiceCallModel.hasCallState",it.CALL_STATES.voiceCallFinish)}))}],["data",{data:{}}]]},isLoading:{rules:[["display",{display:Object(o.c)((function(e){return e.apply("loadingModel.isLoading")}))}]]},notLoading:{rules:[["display",{display:Object(o.c)((function(e){return!e.apply("loadingModel.isLoading")}))}]]}})(st),pt=a("qBRZ"),ft=a("MUIY"),gt=a("mTHn"),vt=function(){return s.a.createElement(gt.a,{to:"/login"},s.a.createElement(i.a,{className:"serviceSessionPage"},(function(e,t){return s.a.createElement(s.a.Fragment,null,s.a.createElement(i.a,{className:"paymentStep"},(function(e,t){return s.a.createElement(s.a.Fragment,null,s.a.createElement(pt.a,null))})),s.a.createElement(i.a,{className:"confirmStep"},(function(e,t){return s.a.createElement(s.a.Fragment,null,s.a.createElement(ft.a,null))})),s.a.createElement(i.a,{className:"serviceStep"},(function(e,t){return s.a.createElement(s.a.Fragment,null,s.a.createElement(mt,null))})),s.a.createElement(i.a,{className:"completedStep"},(function(e,t){return s.a.createElement(s.a.Fragment,null,s.a.createElement(de,null))})))})))},ht=a("1mr4"),bt=a.n(ht),yt=a("mbB6"),St=["payment","confirm","cancel","service","completed"],xt={};a.n(yt)()(St,(function(e,t){return xt[e]=t}));var Ct=Object(o.a)({serviceSessionPage:{rules:[["data",{data:{stepModel:Object(o.c)((function(e){var t=Object(K.a)(),a=z()(t,"params",{}),n=z()(a,"step",B()(St)),r=s.a.useState(n),i=r[0],l=r[1];return s.a.useEffect((function(){i!==n&&l(n)}),[i,l,n]),{currentStep:i,setStep:function(e){return bt()(xt,e)&&l(e)},hasNext:function(){},nextStep:function(){},prevStep:function(){},handlers:{callAgain:function(){var a={step:"confirm",status:void 0},n=t.redirectUrl(a,{origin:!1});t.navigate(n,{relace:!0}),t.setRouteState(a),e.apply("stepModel.setStep",a.step)},callFinish:function(){var n=e.apply("routeStore.toUrl","advisor",a);t.navigateExternal(n)}}}}))}}]]},paymentStep:{rules:[["display",{display:Object(o.c)((function(e){return e.get("stepModel.currentStep")===St[0]}))}]]},confirmStep:{rules:[["display",{display:Object(o.c)((function(e){return z()(Object(K.a)(),"params.purchase_id")&&e.get("stepModel.currentStep")===St[1]}))}]]},serviceStep:{rules:[["display",{display:Object(o.c)((function(e){return z()(Object(K.a)(),"params.purchase_id")&&e.get("stepModel.currentStep")===St[3]}))}]]},completedStep:{rules:[["display",{display:Object(o.c)((function(e){return z()(Object(K.a)(),"params.purchase_id")&&e.get("stepModel.currentStep")===St[4]}))}]]},isLoading:{rules:[["display",{display:Object(o.c)((function(e){return e.apply("loadingModel.isLoading")}))}]]},notLoading:{rules:[["display",{display:Object(o.c)((function(e){return!e.apply("loadingModel.isLoading")}))}]]}})(vt),Et=a("0M34"),wt=a("caL3"),Nt=a("IkJg"),Tt=a("bQnF"),_t=Object(Nt.a)((function(e){return s.a.createElement(c.a,null,s.a.createElement(wt.a,{location:e.location,PageData:Tt.a},s.a.createElement(i.a,null,(function(e,t){return s.a.createElement(s.a.Fragment,null,s.a.createElement(Et.a,{pageData:t.apply("ctf.findPage",{name:"Homepage"})}),s.a.createElement(wt.a.POS,{name:"app-header"},t.apply("ctf.renderSection",{name:"articleNavbarSection"})),s.a.createElement(wt.a.POS,{name:"app-body"},s.a.createElement("div",{className:"wrapper app-row"},s.a.createElement("div",{className:"relative overflow-hidden"},s.a.createElement(Ct,null)))),s.a.createElement(wt.a.POS,{name:"app-footer"},t.apply("ctf.renderSection",{name:"articleFooterSection"})))}))))}));t.default=_t}}]);
//# sourceMappingURL=component---src-templates-voicecall-index-js-a96dddc24be8d1620b98.js.map